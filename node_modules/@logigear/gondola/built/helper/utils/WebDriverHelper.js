"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.moveMouseByJS=exports.clickSafariByJS=exports.clickSafari=exports.clickMobileWeb=exports.doubleClick_safari=exports.rightClickByJS=exports.rightClick=exports.usingFirstElement=exports.findClickable=exports.assertElementExists=exports.prepareLocateFn=void 0;const errors=__importStar(require("../../errors")),WebUtils_1=require("./WebUtils"),ElementNotFound=require("codeceptjs/lib/helper/errors/ElementNotFound"),{xpathLocator:xpathLocator}=require("codeceptjs/lib/utils"),Locator=require("codeceptjs/lib/locator"),{debug:debug}=require("codeceptjs/lib/output");function prepareLocateFn(e){return e?t=>(t=new Locator(t,"css"),this._locate(e,!0).then(async i=>(assertElementExists(i,e,"Context element"),t.react?i[0].react$$(t.react,t.props||void 0):i[0].$$(t.simplify())))):this._locate.bind(this)}function assertElementExists(e,t,i,n){if(!e||0===e.length)throw new ElementNotFound(t,i,n)}async function findClickable(e,t){if((e=new Locator(e)).isAccessibilityId()&&!this.isWeb)return await t.call(this,e,!0);if(!e.isFuzzy())return await t.call(this,e,!0);let i;const n=xpathLocator.literal(e.value);return i=await t.call(this,Locator.clickable.narrow(n)),i.length?i:(i=await t.call(this,Locator.clickable.wide(n)),i.length?i:(i=await t.call(this,Locator.clickable.self(n)),i.length?i:await t.call(this,e.value)))}function usingFirstElement(e){return e.length>1&&debug("[Elements] Using first element out of "+e.length),e[0]}async function rightClick(e,t,i){const n=await locateElement(e,t,i);await n.moveTo(),await n.click({button:2})}async function rightClickByJS(e,t,i){const n=prepareLocateFn.call(e,i),a=await findClickable.call(e,t,n);i?assertElementExists(a,t,"Clickable element","was not found inside element "+new Locator(i)):assertElementExists(a,t,"Clickable element");const r=usingFirstElement(a);await r.moveTo(),await e.executeScript(e=>{const t=new MouseEvent("contextmenu",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)},r)}async function doubleClick_safari(e,t,i){const n=await locateElement(e,t,i);await e.executeScript(e=>{const t=new MouseEvent("dblclick",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)},n)}async function clickMobileWeb(e,t,i){const n=await locateElement(e,t,i);return e.browser.elementClick(WebUtils_1.getElementId(n))}async function clickSafari(e,t,i){var n,a,r;const o=await locateElement(e,t,i);if(!await o.isEnabled())throw new errors.GError(errors.GErrorKey.DisabledElementErr,t);!1===await o.isDisplayedInViewport()&&await o.scrollIntoView();const l=WebUtils_1.getElementId(o);return(null===(r=null===(a=null===(n=e.browser)||void 0===n?void 0:n.capabilities)||void 0===a?void 0:a.browserVersion)||void 0===r?void 0:r.startsWith("13.0"))?clickSafari_13_0_x(e,l):e.browser.elementClick(l)}async function clickSafari_13_0_x(e,t){const i=e.browser;let n={x:0,y:0};if(i.getElementLocationInView){const e=await i.getElementLocationInView(t),a=await i.getElementSize(t);n={x:e.x+a.width/2,y:e.y+a.height/2}}else if(i.getElementRect){const e=await i.getElementRect(t);n={x:Math.floor(e.x+e.width/2),y:Math.floor(e.y+e.height/2)}}if(i.isW3C)return await i.performActions([{type:"pointer",id:"mouse0",parameters:{pointerType:"mouse"},actions:[{type:"pointerMove",duration:0,x:n.x,y:n.y},{type:"pointerDown",button:0},{type:"pause",duration:500},{type:"pointerUp",button:0}]}]);await i.moveToElement(null,n.x,n.y),await i.buttonDown(0),await i.buttonUp(0),await i.moveToElement(null,0,0)}async function clickSafariByJS(e,t,i){const n=await locateElement(e,t,i);if(!await n.isEnabled())throw new errors.GError(errors.GErrorKey.DisabledElementErr,t);!1===await n.isDisplayedInViewport()&&await n.scrollIntoView(),await e.executeScript(e=>{const t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)},n)}async function locateElement(e,t,i){const n=prepareLocateFn.call(e,i),a=await findClickable.call(e,t,n);i?assertElementExists(a,t,"Clickable element","was not found inside parent element "+new Locator(i)):assertElementExists(a,t,"Clickable element");return usingFirstElement(a)}async function moveMouseByJS(e,t,i,n){const a=await WebUtils_1.findFirstElement(e,t);return await e.executeScript((e,t,i)=>{const n=new MouseEvent("mousemove",{view:window,bubbles:!0,cancelable:!0,screenX:0,screenY:0,clientX:t,clientY:i});e.dispatchEvent(n)},a,i,n)}exports.prepareLocateFn=prepareLocateFn,exports.assertElementExists=assertElementExists,exports.findClickable=findClickable,exports.usingFirstElement=usingFirstElement,exports.rightClick=rightClick,exports.rightClickByJS=rightClickByJS,exports.doubleClick_safari=doubleClick_safari,exports.clickMobileWeb=clickMobileWeb,exports.clickSafari=clickSafari,exports.clickSafariByJS=clickSafariByJS,exports.moveMouseByJS=moveMouseByJS;
//# sourceMappingURL=../../../debug/helper/utils/WebDriverHelper.js.map
