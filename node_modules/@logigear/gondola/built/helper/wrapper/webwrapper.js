"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebDriverWrapper=void 0;const constants_1=require("../../constants"),errors=__importStar(require("../../errors")),message_1=require("../../message"),WebDriverHelper_1=require("../utils/WebDriverHelper"),Utils=__importStar(require("../utils/WebUtils"));class WebDriverWrapper{async dragAndDrop(e,t,r){let i,o;this._instanceOfCoordinate(e)?i=e:(await this.scrollToElement(e),i=await this.getElementCoordinate(e)),o=this._instanceOfCoordinate(t)?t:await this.getElementCoordinate(t),await this.dragAndDropMouse(i,o,r)}async getControlProperty(e,t){const r=await Utils.findFirstElement(this.helper,e);return await r.getProperty(t)}async moveMouse(e,t){var r,i,o,a,n;if(!this.helper)return;let l,s,c=!0;e&&this._instanceOfCoordinate(e)?(l="//html/body",s=e,c=!1):(l=e,s=t);const h="safari"===(null===(o=null===(i=null===(r=this.helper.browser)||void 0===r?void 0:r.capabilities)||void 0===i?void 0:i.browserName)||void 0===o?void 0:o.toLowerCase()),w=null===(n=null===(a=this.helper.browser)||void 0===a?void 0:a.capabilities)||void 0===n?void 0:n.browserVersion,u=await this.getElementBounds(l);if(!c){let e=0;if(h&&(null==w?void 0:w.startsWith("13.1"))){const t=30;e+=u.top+t}return await this.helper.moveCursorTo(l,null==s?void 0:s.x,(null==s?void 0:s.y)+e)}if(h){const e={x:u.width/2,y:u.height/2},t=null!=s?s:e;return t.x+=u.left,t.y+=u.top,await WebDriverHelper_1.moveMouseByJS(this.helper,l,t.x,t.y)}return await this.helper.moveCursorTo(l,null==s?void 0:s.x,null==s?void 0:s.y)}async selectByIndex(e,t){if(t<0)throw new errors.NegativeNumberError;const r=await Utils.findFirstElement(this.helper,e),i=await r.isClickable(),o=await r.isDisplayed();if(!i||!o)throw new errors.GError(errors.GErrorKey.ElementNotEnabledOrDisplayed,e);const a=(await r.getTagName()).toLowerCase(),n=Utils.getElementId(r);let l="option";"ul"===a&&(l="li");const s=this.helper.browser,c=await s.findElementsFromElement(n,"css selector",l);if(0===c.length)throw new errors.EmptySelectControl;if(c.length-1<t)throw new errors.InvalidSelectOptionIndex(t,c.length);if("select"===a)await r.selectByIndex(t);else{if("ul"!==a)throw new errors.InvalidSelectOptionStrategy(a);{const e=Utils.getElementId(c[t]);if(e)return s.elementClick(e)}}}async setState(e,t){var r,i;const o=this.helper.browser,a=await Utils.findFirstElement(this.helper,e);if(!await a.isEnabled())throw new errors.GError(errors.GErrorKey.DisabledElementErr,e);const n=Utils.getElementId(a);!1===await a.isDisplayedInViewport()&&await a.scrollIntoView();if(await o.isElementSelected(n)!==t){const e=Utils.getBrowserInfo(this.helper.browser);e&&"safari"===(null===(r=e.name)||void 0===r?void 0:r.toLowerCase())&&(null===(i=e.version)||void 0===i?void 0:i.includes("13.0"))?await this.helper.executeScript(e=>{const t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)},a):await o.elementClick(n)}}async scrollIntoView(e,t){return await Utils.scrollIntoView(this.helper,e,t)}async scrollTo(e,t=0,r=0){await this.helper.scrollTo(e,t,r)}async getElementBounds(e){const t=this.helper.browser,{scrollX:r,scrollY:i}=await Utils.getScrollOffset(t),{x:o,y:a,width:n,height:l}=await this.helper.grabElementBoundingRect(e);return{left:o-r,top:a-i,width:n,height:l}}async waitForElementProperty(e,t,r,i){const o=await Utils.findFirstElement(this.helper,e);if(!await this.helper.executeScript((e,t,r)=>typeof e[t]!==r.UNDEFINED,o,t,constants_1.TYPE_OF_VAR))throw new errors.InvalidElementPropertyError(e,t);const a=message_1.format(message_1.localize(errors.GErrorKey.TimeOutForElementHasProptery),e,t,r);await this.helper.browser.waitUntil(async()=>await o.getProperty(t)===r,{timeout:1e3*i,timeoutMsg:a,interval:500})}async waitForValueChanged(e,t,r,i){const o=await Utils.findFirstElement(this.helper,e);if(!await this.helper.executeScript((e,t,r)=>typeof e[t]!==r.UNDEFINED,o,t,constants_1.TYPE_OF_VAR))throw new errors.InvalidElementPropertyError(e,t);const a=message_1.format(message_1.localize(errors.GErrorKey.TimeoutForValueChange),e,t),n=await o.getProperty(t);i&&n===i||await this.helper.browser.waitUntil(async()=>await o.getProperty(t)!==n,{timeout:1e3*r,timeoutMsg:a,interval:500})}_instanceOfCoordinate(e){return!(typeof e===constants_1.TYPE_OF_VAR.STRING||!e)&&("x"in e&&"y"in e)}async dragAndDropMouse(e,t,r){var i,o,a;const n=null===(i=this.helper)||void 0===i?void 0:i.browser;if(!n)return;const l=Math.floor(t.x-e.x),s=Math.floor(t.y-e.y);let c=0;const h=await Utils.getBrowserInfo(this.helper.browser);h&&"safari"===(null===(o=h.name)||void 0===o?void 0:o.toLowerCase())&&(null===(a=h.version)||void 0===a?void 0:a.includes("13.1"))&&(c=await Utils.getDeviationHeight(n)),n.isW3C?(await n.performActions([{type:"pointer",id:"finger1",parameters:{pointerType:"mouse"},actions:[{type:"pointerMove",duration:0,x:e.x,y:e.y+c},{type:"pointerDown",button:0},{type:"pause",duration:750},{type:"pointerMove",origin:"pointer",duration:r,x:l,y:s},{type:"pointerUp",button:0}]}]),await n.releaseActions()):(await n.moveToElement(null,Math.floor(e.x),Math.floor(e.y)),await n.buttonDown(0),await this.moveIt(n,e,t,r),await n.buttonUp(0),await n.moveToElement(null,Math.floor(-1*t.x),Math.floor(-1*t.y)))}async moveIt(e,t,r,i){if(!e)return;let o=1500;void 0!==i&&(o=i);const a=Math.floor(o/30),n=(r.x-t.x)/o,l=(r.y-t.y)/o;let s=Math.floor(t.x),c=Math.floor(t.y);for(let r=1;r<=a;r++){const i=Math.floor(t.x+30*n*r),o=Math.floor(t.y+30*l*r);await e.moveToElement(null,i-s,o-c),await e.pause(20),s=i,c=o}await e.moveToElement(null,Math.floor(r.x-s),Math.floor(r.y-c))}async getElementCoordinate(e){var t;const r=null===(t=this.helper)||void 0===t?void 0:t.browser;let i={x:0,y:0};const{scrollX:o,scrollY:a}=await Utils.getScrollOffset(r);if(!r)return i;const n=await this.helper._locate(e,!1),l=Utils.getElementId(n[0]);if(r.getElementLocationInView){const e=await r.getElementLocationInView(l),t=await r.getElementSize(l);if(!e||!t)return i;i={x:e.x-o+t.width/2,y:e.y-a+t.height/2}}else if(r.getElementRect){const e=await r.getElementRect(l);if(!e)return i;i={x:Math.floor(e.x-o+e.width/2),y:Math.floor(e.y-a+e.height/2)}}return i}async scrollToElement(e){const t=await Utils.findFirstElement(this.helper,e);t&&await t.scrollIntoView()}}exports.WebDriverWrapper=WebDriverWrapper,exports.default=new WebDriverWrapper;
//# sourceMappingURL=../../../debug/helper/wrapper/webwrapper.js.map
