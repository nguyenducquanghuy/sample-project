!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("@logigear/telemetry",[],t):"object"==typeof exports?exports["@logigear/telemetry"]=t():e["@logigear/telemetry"]=t()}(global,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Extension=0]="Extension",e[e.SpreadSheetEditor=1]="SpreadSheetEditor",e[e.HeliumFW=2]="HeliumFW",e[e.TestBuilder=3]="TestBuilder",e[e.Environment=4]="Environment"}(t.EventCategory||(t.EventCategory={})),function(e){e[e.StartupExtension=0]="StartupExtension",e[e.StartGSE=1]="StartGSE"}(t.UserTimingVariable||(t.UserTimingVariable={})),t.LimitCallsPerRequest=1e3,t.trackingIDs={DEV:"UA-155073229-1",MARK:"UA-134732439-2"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r="Gondola Telemetry:";t.logger=new class{constructor(){this.isActive=!0}setActive(e){this.isActive=e}info(e){this.isActive&&console.log(`${r} ${e}`)}warn(e,t){this.error(e,t)}error(e,t){this.isActive&&(t?console.error(`${r} ${e}`,t):console.error(`${r} ${e}`))}}},function(e,t){e.exports=require("node-machine-id")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sendTelemetryEvent=t.sendActionsStatistic=t.EventCategory=t.envInfo=t.captureTelemetry=t.EventName=void 0;const r=n(4);Object.defineProperty(t,"captureTelemetry",{enumerable:!0,get:function(){return r.captureTelemetry}}),Object.defineProperty(t,"EventCategory",{enumerable:!0,get:function(){return r.EventCategory}}),Object.defineProperty(t,"sendActionsStatistic",{enumerable:!0,get:function(){return r.sendActionsStatistic}}),Object.defineProperty(t,"sendTelemetryEvent",{enumerable:!0,get:function(){return r.sendTelemetryEvent}});const i=n(11);t.EventName={GenerateReport:"GenerateReport",StartTest:"StartTest",EndTest:"EndTest"};const o={isTestExecuted:!0,av:i.getGondolaVersion()};t.envInfo=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5),i=n(0);t.EventCategory=i.EventCategory,t.UserTimingVariable=i.UserTimingVariable;const o=n(1),s=n(10);let c;function a(){return c||(c=new r.Analyzer),c}async function u(e,t,n,r,s,c,u,l,d){if("boolean"==typeof e){if(!1===e)return}else if(!1===e())return;await new Promise(async(e,f)=>{try{let f=!0;d&&("boolean"==typeof d.isTestExecuted?(f=!d.isTestExecuted,d.isSkipped=t!==i.EventCategory.HeliumFW&&d.isTestExecuted):"function"==typeof d.isTestExecuted&&(f=!1===d.isTestExecuted(),d.isSkipped=t!==i.EventCategory.HeliumFW&&!0===d.isTestExecuted())),o.logger.setActive(f),o.logger.info(JSON.stringify(u)),o.logger.info(JSON.stringify(l)),o.logger.info(`${s} - ${c}`),o.logger.info(JSON.stringify(d));const g=a();if(g)if(u&&"object"==typeof u){const e=u;await g.environment(t,e,d)}else g.event(t,n,r,d);e()}catch(e){o.logger.error("Failed to send analytics: "+e),f()}})}t.sendActionsStatistic=async function(e,t,n){if("boolean"==typeof e){if(!1===e)return}else if(!1===e())return;await new Promise(async(e,r)=>{try{const e=i.EventCategory.HeliumFW;let r=!0;n&&("boolean"==typeof n.isTestExecuted?(r=!n.isTestExecuted,n.isSkipped=e!==i.EventCategory.HeliumFW&&n.isTestExecuted):"function"==typeof n.isTestExecuted&&(r=!1===n.isTestExecuted(),n.isSkipped=e!==i.EventCategory.HeliumFW&&!0===n.isTestExecuted())),o.logger.setActive(r),o.logger.info(JSON.stringify(n));const s=a();s&&await s.trackAction(e,t,n)}catch(e){o.logger.error("Failed to send analytics: "+e),r()}e()})},t.sendLocatorsStatistic=async function(e,t,n){if("boolean"==typeof e){if(!1===e)return}else if(!1===e())return;const r=i.EventCategory.HeliumFW;let s=!0;n&&("boolean"==typeof n.isTestExecuted?(s=!n.isTestExecuted,n.isSkipped=r!==i.EventCategory.HeliumFW&&n.isTestExecuted):"function"==typeof n.isTestExecuted&&(s=!1===n.isTestExecuted(),n.isSkipped=r!==i.EventCategory.HeliumFW&&!0===n.isTestExecuted())),o.logger.setActive(s),o.logger.info(JSON.stringify(n));const c=a();if(c)for(const[e,i]of t)await c.trackLocator(r,e,i,n)},t.sendTelemetryEvent=u,t.captureTelemetry=function(e,t,n,r,i,o=!0,c){return(a,l,d)=>{const f=d.value;return d.value=function(...a){if(!1===e())return f.apply(this,a);const l=new s.StopWatch;if(!o)return u(e,t,n,r,l.startTime,void 0,i,void 0,c),f.apply(this,a);const d=f.apply(this,a);return d&&"function"==typeof d.then&&"function"==typeof d.catch?d.then(o=>(u(e,t,n,r,l.startTime,l.elapsedTime,i,void 0,c),o)).catch(o=>{(i=i||{}).failed=!0,u(e,t,n,r,l.startTime,l.elapsedTime,i,o,c)}):u(e,t,n,r,l.startTime,l.elapsedTime,i,void 0,c),d},d}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),i=n(1),o=n(6);t.Analyzer=class{constructor(){i.logger.info("Create new GAReporter successfully"),this.report=new o.GAReporter}async trackAction(e,t,n){if(this.report){const i=[];for(const[n,r]of t){const t={t:"event",ec:this.getEventCategory(e),el:n,ea:"Action",ev:r};i.push(Object.assign({},t))}if(r.LimitCallsPerRequest>i.length)await this.report.send(i,n);else for(let e=0;e<i.length;e+=r.LimitCallsPerRequest){const t=i.slice(e,e+r.LimitCallsPerRequest);await this.report.send(t,n)}}}async trackLocator(e,t,n,r){if(this.report){const i={t:"event",ec:this.getEventCategory(e),el:t,ea:"LocatorStrategy",ev:n};return this.report.send(i,r)}}async environment(e,t,n){if(this.report){const r=[];for(const[n,i]of Object.entries(t)){const t={ec:this.getEventCategory(e),ea:n,t:"event",el:i};r.push(Object.assign({},t))}await this.report.send(r,n)}}async event(e,t,n,r){if(this.report){const i={ec:this.getEventCategory(e),ea:t,t:"event",el:n};this.report.send(i,r)}}error(e,t,n){const r={exd:e.split(/[\n\{\/\\]/)[0].substring(0,150).trim(),exf:t?1:0,t:"exception"};this.report.send(r,n)}time(e,t,n,i,o){const s={t:"timing",utc:this.getEventCategory(e),utl:i,utt:Math.round(n),utv:r.UserTimingVariable[t]};this.report.send(s,o)}getEventCategory(e){return"string"==typeof e?e:r.EventCategory[e]}}},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const i=r(n(7)),o=n(2),s=r(n(8)),c=n(9),a=n(1);t.GAReporter=class{async send(e,t){if(t&&!0===t.isSkipped)return;let n="/collect";Array.isArray(e)&&(n="/batch");const r={aip:1,an:"Gondola Studio",av:t&&t.av?t.av:"",tid:c.getTrackingID(),ul:t&&t.ul?t.ul:"",v:"1"};let i;i=t&&t.cid?t.cid:await o.machineId(!0),Object.assign(r,{cid:i}),t&&t.uid&&Object.assign(r,{uid:t.uid});const u=[];Array.isArray(e)?e.forEach(e=>{u.push(Object.assign({},r,e))}):u.push(Object.assign({},r,e)),c.isDebugging()&&a.logger.info(JSON.stringify(u));const l={headers:{"Content-Type":"application/x-www-form-urlencoded"},hostname:"www.google-analytics.com",method:"POST",path:c.isDebugging()?"/debug"+n:n,port:443},d=u.map(e=>s.stringify(e)).join("\n");await this.handleRequest(l,d)}async handleRequest(e,t){try{const n=i.request(e,e=>(c.isDebugging()&&e.on("data",e=>{try{const t=JSON.parse(e.toString());t&&t.hitParsingResult&&!0===t.hitParsingResult[0].valid||(t&&t.hitParsingResult&&!1===t.hitParsingResult[0].valid?a.logger.warn(e.toString()):a.logger.warn("Unexpected GA debug response: "+e.toString()))}catch(t){a.logger.warn("Error in GA debug response: "+e.toString())}}),(!e||!e.statusCode||e.statusCode<200||e.statusCode>300)&&a.logger.info(`Failed to send analytics ${e&&e.statusCode}: ${e&&e.statusMessage}`),e));n.on("error",e=>{c.isDebugging()&&a.logger.error("Failed to make http request: "+e)}),n.write(t),n.end()}catch(e){return a.logger.error("Failed to send analytics: "+e),e}}}},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("querystring")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.isDebugging=()=>"true"===process.env.GS_DEBUG_MODE,t.isTesting=()=>"true"===process.env.GS_TESTING_MODE,t.getTrackingID=function(){return t.isTesting()?r.trackingIDs.DEV:r.trackingIDs.MARK}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StopWatch=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}get startTime(){return this.started}reset(){this.started=Date.now()}}},function(e,t,n){"use strict";(function(e){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getBrowserName=t.handleErrorMessage=t.getMachineID=t.captureUserEnvironment=t.getReporterName=t.getOS=t.isXPath=t.resolveAttachFileDir=t.getRootDir=t.getAgentType=t.getLSInfo=t.getTokenInfo=t.isAllowedTelemetry=t.getConfigPath=t.getGondolaVersion=t.getLocatorString=t.isEmpty=void 0;const s=n(12),{getConfig:c}=n(13),a=n(14),u=o(n(15)),l=n(2),d=o(n(16)),f=o(n(17)),g=n(18);function p(){const e=f.resolve(".","./node_modules/@logigear/gondola/package.json"),t=u.readFileSync(e,"utf-8");return JSON.parse(t).version}function y(){let e="./gondola.json";const t=process.argv;if(t.includes("--config")){const n=t.indexOf("--config")+1;n<t.length&&(e=t[n])}else if(t.includes("-c")){const n=t.indexOf("-c")+1;n<t.length&&(e=t[n])}return e}function v(){let e;const t=y();if(u.existsSync(t)){const r=f.resolve(".",t);e=c(r);const i=process.argv;if(i.includes("--override")||i.includes("-o"))try{const t=i.includes("--override")?i.indexOf("--override"):i.indexOf("-o");if(t+1<i.length){const r=i[t+1];if(r&&"-"!==r.charAt(0)){const t=JSON.parse(r);n(19)(e,t)}}}catch(e){}}return e}var m,h;function b(){return e.split("node_modules")[0]}function E(){return d.type()+" "+d.release()}function T(){const e=process.argv,t=e.findIndex(e=>"--reporter"===e||"--R"===e);let n="";return t>=0&&(n=e[t+1]),n}t.isEmpty=e=>null===e||!(Object.keys(e)||e).length,t.getLocatorString=function(e){var t;return typeof e===g.TYPE_OF_VAR.OBJECT?(null===(t=e)||void 0===t?void 0:t.value)||JSON.stringify(e):new s(e).toString()},t.getGondolaVersion=p,t.getConfigPath=y,t.isAllowedTelemetry=function(){let e=!0;const t=v();return t&&!1===t.telemetry&&(e=t.telemetry),e},t.getTokenInfo=function(){let e="";const t=v();return t&&""!==t.licenseToken&&void 0!==t.licenseToken&&(e=t.licenseToken),e},t.getLSInfo=function(){let e="";const t=v();return t&&""!==t.licenseServer&&void 0!==t.licenseServer&&(e=t.licenseServer),e},(h=m||(m={})).unknown="unknown",h.mobile="mobile",h.web="web",h.enterprise="enterprise",t.getAgentType=function(){let e=m.unknown;const t=y();if(u.existsSync(t)){const n=f.resolve(".",t),r=c(n);r&&r.helpers&&(r.helpers.Protractor||r.helpers.WebDriver?e=m.web:r.helpers.Appium&&(e=r.helpers.Appium.desiredCapabilities&&r.helpers.Appium.desiredCapabilities.browserName?m.web:m.mobile))}return e},t.getRootDir=b,t.resolveAttachFileDir=function(e){const t=f.relative(global.codecept_dir,b());return f.join(t,e)},t.isXPath=function(e){const t=e.replace(/^\(+/,"").substr(0,2);return"//"===t||"./"===t},t.getOS=E,t.getReporterName=T,t.captureUserEnvironment=function(e){const t={};return e&&(t.BrowserName=e.browserName,t.BrowserVersion=e.version||e.browserVersion,t.Platform=E(),t.GondolaVersion=p(),t.Reporter=T(),t.DeviceManufacturer=e.deviceManufacturer,t.DeviceModel=e.deviceModel,t.DeviceScreenSize=e.deviceScreenSize),t},t.getMachineID=async function(){return await l.machineId(!0)},t.handleErrorMessage=function(e,t){const n=e.message.split(":"),r=e.stack.split(":");if(!n.includes("invalid selector")&&!r.includes("invalid selector"))throw new Error(e.message);throw new a(t)},t.getBrowserName=function(){var e;return null===(e=v().helpers.WebDriver)||void 0===e?void 0:e.browser}}).call(this,"built")},function(e,t){e.exports=require("codeceptjs/lib/locator")},function(e,t){e.exports=require("codeceptjs/lib/command/utils")},function(e,t){e.exports=require("codeceptjs/lib/helper/errors/ElementNotFound")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE_OF_VAR=void 0,t.TYPE_OF_VAR={FUNCTION:"function",OBJECT:"object",STRING:"string",NUMBER:"number",BOOLEAN:"boolean",UNDEFINED:"undefined"}},function(e,t){e.exports=require("lodash.merge")}])}));