"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getBrowserName=exports.handleErrorMessage=exports.getMachineID=exports.captureUserEnvironment=exports.getReporterName=exports.getOS=exports.isXPath=exports.resolveAttachFileDir=exports.getRootDir=exports.getAgentType=exports.getLSInfo=exports.getTokenInfo=exports.isAllowedTelemetry=exports.getConfigPath=exports.getGondolaVersion=exports.getLocatorString=exports.isEmpty=void 0;const Locator=require("codeceptjs/lib/locator"),{getConfig:getConfig}=require("codeceptjs/lib/command/utils"),ElementNotFound=require("codeceptjs/lib/helper/errors/ElementNotFound"),fs=__importStar(require("fs")),node_machine_id_1=require("node-machine-id"),os=__importStar(require("os")),path=__importStar(require("path")),constants_1=require("./constants");function getLocatorString(e){var t;return typeof e===constants_1.TYPE_OF_VAR.OBJECT?(null===(t=e)||void 0===t?void 0:t.value)||JSON.stringify(e):new Locator(e).toString()}function getGondolaVersion(){const e=path.resolve(".","./node_modules/@logigear/gondola/package.json"),t=fs.readFileSync(e,"utf-8");return JSON.parse(t).version}function getConfigPath(){let e="./gondola.json";const t=process.argv;if(t.includes("--config")){const r=t.indexOf("--config")+1;r<t.length&&(e=t[r])}else if(t.includes("-c")){const r=t.indexOf("-c")+1;r<t.length&&(e=t[r])}return e}function getJSONConfig(){let e;const t=getConfigPath();if(fs.existsSync(t)){const r=path.resolve(".",t);e=getConfig(r);const o=process.argv;if(o.includes("--override")||o.includes("-o"))try{const t=o.includes("--override")?o.indexOf("--override"):o.indexOf("-o");if(t+1<o.length){const r=o[t+1];if(r&&"-"!==r.charAt(0)){const t=JSON.parse(r);require("lodash.merge")(e,t)}}}catch(e){}}return e}function isAllowedTelemetry(){let e=!0;const t=getJSONConfig();return t&&!1===t.telemetry&&(e=t.telemetry),e}function getTokenInfo(){let e="";const t=getJSONConfig();return t&&""!==t.licenseToken&&void 0!==t.licenseToken&&(e=t.licenseToken),e}function getLSInfo(){let e="";const t=getJSONConfig();return t&&""!==t.licenseServer&&void 0!==t.licenseServer&&(e=t.licenseServer),e}var AgentType;function getAgentType(){let e=AgentType.unknown;const t=getConfigPath();if(fs.existsSync(t)){const r=path.resolve(".",t),o=getConfig(r);o&&o.helpers&&(o.helpers.Protractor||o.helpers.WebDriver?e=AgentType.web:o.helpers.Appium&&(e=o.helpers.Appium.desiredCapabilities&&o.helpers.Appium.desiredCapabilities.browserName?AgentType.web:AgentType.mobile))}return e}function getRootDir(){return __dirname.split("node_modules")[0]}function resolveAttachFileDir(e){const t=path.relative(global.codecept_dir,getRootDir());return path.join(t,e)}function isXPath(e){const t=e.replace(/^\(+/,"").substr(0,2);return"//"===t||"./"===t}function getOS(){return os.type()+" "+os.release()}function getReporterName(){const e=process.argv,t=e.findIndex(e=>"--reporter"===e||"--R"===e);let r="";return t>=0&&(r=e[t+1]),r}function captureUserEnvironment(e){const t={};return e&&(t.BrowserName=e.browserName,t.BrowserVersion=e.version||e.browserVersion,t.Platform=getOS(),t.GondolaVersion=getGondolaVersion(),t.Reporter=getReporterName(),t.DeviceManufacturer=e.deviceManufacturer,t.DeviceModel=e.deviceModel,t.DeviceScreenSize=e.deviceScreenSize),t}async function getMachineID(){return await node_machine_id_1.machineId(!0)}function handleErrorMessage(e,t){const r=e.message.split(":"),o=e.stack.split(":");if(!r.includes("invalid selector")&&!o.includes("invalid selector"))throw new Error(e.message);throw new ElementNotFound(t)}function getBrowserName(){var e;return null===(e=getJSONConfig().helpers.WebDriver)||void 0===e?void 0:e.browser}exports.isEmpty=e=>null===e||!(Object.keys(e)||e).length,exports.getLocatorString=getLocatorString,exports.getGondolaVersion=getGondolaVersion,exports.getConfigPath=getConfigPath,exports.isAllowedTelemetry=isAllowedTelemetry,exports.getTokenInfo=getTokenInfo,exports.getLSInfo=getLSInfo,function(e){e.unknown="unknown",e.mobile="mobile",e.web="web",e.enterprise="enterprise"}(AgentType||(AgentType={})),exports.getAgentType=getAgentType,exports.getRootDir=getRootDir,exports.resolveAttachFileDir=resolveAttachFileDir,exports.isXPath=isXPath,exports.getOS=getOS,exports.getReporterName=getReporterName,exports.captureUserEnvironment=captureUserEnvironment,exports.getMachineID=getMachineID,exports.handleErrorMessage=handleErrorMessage,exports.getBrowserName=getBrowserName;
//# sourceMappingURL=../debug/util.js.map
